<!DOCTYPE html>
<html>
  <head>
    <title>Wireframe View</title>
    <!-- <link rel="stylesheet" href="css/wireframe.css" /> -->
    <script>

    </script>
    <style>
      #editor {
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
      }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js"
      integrity="sha512-UxcTlYsLkcuGZL9JNnMsfo3p7VFSmcgBjH1VUSM82Okk5ni52bk7vz9f2p+D1VnMcNUmMzbzgWqWcdJ2j8Svow=="
      crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css"
      integrity="sha512-xIf9AdJauwKIVtrVRZ0i4nHP61Ogx9fSRAkCLecmE2dL/U8ioWpDvFCAy4dcfecN72HHB9+7FfQj3aiO68aaaw=="
      crossorigin="anonymous" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/addon/fold/xml-fold.min.js"
      integrity="sha512-A687y0hhrzGSJA+Vy0K5wJ+XSIPKjzEujKsc9WCoWfub25q4THmIX94P6ofM5tuUMDuX4SKzjOeliJMbDpyyAQ=="
      crossorigin="anonymous"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/xml/xml.min.js"
      integrity="sha512-k1HnoY9EXahEfPz7kq/lD9DltloKH9OrB9XNKYoUQrNz9epe5F4mQP5PfuIfeRfoXHkNrE0gF3Mx4LhC5BVl9Q=="
      crossorigin="anonymous"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/addon/fold/foldcode.min.js"
      integrity="sha512-tY7fzPt8kpPkGBPzs0ctZAm6+w1vPG/5sm2oPzbuUimqQfVOFJGi8eB7jo8BBEQjwOPuQq4UT04Bbgjuzk//aQ=="
      crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/addon/fold/foldgutter.min.css"
      integrity="sha512-YwkMTlTHn8dBnwa47IF+cKsS00HPiiVhQ4DpwT1KF2gUftfFR7aefepabSPLAs6zrMyD89M3w0Ow6mQ5XJEUCw=="
      crossorigin="anonymous" />
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/addon/fold/foldgutter.min.js" integrity="sha512-R5ILz8pTG+G29aszTP4k5AbDWbxoaKJ9ilK+hseQVKuuoTNOo95nCbfQYInLhKdsWCKY1sa9Lis2pblTQ0U57A==" crossorigin="anonymous"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/addon/fold/indent-fold.min.js"
      integrity="sha512-Q6g5qQfa6ko+Y+0BwAciUAq01qxgfScTPFP2Fsrr+zIrTe5Yq3tN5xaA919MmBs/1RMz/jyctknYavjc3k+/xg=="
      crossorigin="anonymous"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/addon/fold/xml-fold.min.js"
      integrity="sha512-A687y0hhrzGSJA+Vy0K5wJ+XSIPKjzEujKsc9WCoWfub25q4THmIX94P6ofM5tuUMDuX4SKzjOeliJMbDpyyAQ=="
      crossorigin="anonymous"></script>
      

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/theme/solarized.min.css"
      integrity="sha512-9eh7EKENNB3CJcWthLysOUEcOw1hCVES0IoNcgLeKRgcG1j1HRNXST3b1i7SV/XQEFGAvg7RMm5XbHfdaA0juQ=="
      crossorigin="anonymous" />

    <script src="./js/xml-formatter.js"></script>

    <link rel="icon"
      href="data:image/svg+xml,&lt;svg xmlns='http://www.w3.org/2000/svg' width='1em' height='1em'>&lt;text y='.9em'>ðŸŽƒ&lt;/text>&lt;/svg>" />


    <style>
      .CodeMirror {
        height: 100%;
        width: 100%;
        font-family: 'Roboto Mono';
        font-size: 18px;
      }
    </style>

  </head>
  <body>
    <div id="editor"></div>
    <script>
      var inputFilename = '/' + location.search.substr(1);
      document.title += ' : ' + location.search.substr(1);
    </script>
    <script>
      var processor = new XSLTProcessor();

      function loadXMLDoc(filename) {
        var xhttp = new XMLHttpRequest();
        console.log("AHOY", filename);
        xhttp.open("GET", filename, false);
        xhttp.send("");
        return xhttp.responseXML;
      }

      var inputDocument;
      var xsltDocument;
      var resultDocument;

      var baseName = inputFilename.split('/').pop();
      inputDocument = loadXMLDoc(inputFilename);

      var now = Date.now();
      var transformDocXML = `<?xml version="1.0" encoding="UTF-8" ?>
<xsl:stylesheet version="1.0" xmlns="http://www.w3.org/1999/xhtml" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:dlxs="http://dlxs.org" xmlns:qbat="http://dlxs.org/quombat">
  <xsl:import href="/xsl/social.wireframe.xsl?now=${now}" />
  <xsl:import href="/xsl/${baseName.replace('.xml', '.wireframe.xsl')}?_=${now}" />
  <xsl:import href="${inputFilename.replace('.xml', '.wireframe.xsl')}?_=${now}" />
  <xsl:import href="/xsl/wireframe.xsl?_=${now}" />
</xsl:stylesheet>`;

console.log(transformDocXML);
      var parser = new DOMParser();
      var transformDoc = parser.parseFromString(transformDocXML, "text/xml");

      processor.reset();

      try {
        processor.importStylesheet(transformDoc);
      } catch(err) {
        console.log(err);
      }

      resultDocument = processor.transformToFragment(inputDocument, document);

      // // and then add all the classes
      // var style = document.createElement('style');
      // document.head.appendChild(style);

      // var elements = resultDocument.querySelectorAll('*');
      // var seen = {};
      // for (var i = 0; i < elements.length; i++) {
      //   var element = elements[i];
      //   if (seen[element.tagName]) { continue; }
      //   seen[element.tagName] = true;
      //   style.sheet.insertRule(`${element.localName}::before { content: '<${element.tagName}>'; }`);
      //   style.sheet.insertRule(`${element.localName}::after { content: '</${element.tagName}>'; }`);
      // }
          
      console.log(resultDocument);
      // document.body.appendChild(resultDocument);

      var serializer = new XMLSerializer();
      var formatter = require('xml-formatter');
      var xmldata = formatter(serializer.serializeToString(resultDocument), { collapseContent: true });

      var editor = CodeMirror(document.querySelector('#editor'),
        {
          value: xmldata,
          mode: 'xml',
          tabSize: 2,
          readOnly: true,
          theme: 'solarized dark',
          foldGutter: true,
          lineNumbers: true,
          lineWrapping: false,
          gutters: [ 'CodeMirror-linenumbers', 'CodeMirror-foldgutter']
        }
      );


    </script>
  </body>
</html>